# Enhancing Taobao Display Advertising with Multimodal Representations: Challenges, Approaches and Insights
[原文链接](https://doi.org/10.1145/3383313.3412236)
## 0 摘要：
丰富的用户行为数据已被证明对于点击率预测任务具有极大价值，尤其是在推荐系统和在线广告等工业应用中。工业界和学术界都对这一主题给予了极大关注，并提出了多种针对长序列用户行为数据建模的方法。其中，阿里巴巴提出的基于记忆网络的模型 MIMN[8] 在学习算法和服务器系统协同设计方面达到了最先进的水平。MIMN 是首个能够对长度高达 1000 的用户行为序列进行建模的工业解决方案。然而，当用户行为序列的长度进一步增加，比如增加 10 倍或更多时，MIMN 无法精确捕捉用户对于特定候选项目的兴趣。这一挑战在先前提出的方法中普遍存在。在本文中，我们通过设计一种新的建模范式来解决这一问题，我们将这种范式命名为基于搜索的兴趣模型（SIM）。SIM 通过两个级联搜索单元提取用户兴趣：（i）通用搜索单元（GSU）从原始且任意长的序列行为数据中进行通用搜索，查询信息来自候选项目，并获取与候选项目相关的子用户行为序列（SBS）；（ii）精确搜索单元（ESU）建模候选项目与 SBS 之间的精确关系。这种级联搜索范式使 SIM 在可扩展性和准确性方面都具有更好的能力来建模终身序列行为数据。除了学习算法，我们还介绍了在大规模工业系统中实现 SIM 的实际经验。自 2019 年以来，SIM 已在阿里巴巴的展示广告系统中部署，带来了 7.1% 的点击率（CTR）和 4.4% 的每千次展示收入（RPM）提升，这对业务具有重要意义。目前在我们的实际系统中服务主要流量，SIM 能够建模最大长度达到 54000 的序列用户行为数据，将最先进水平提升了 54 倍。

## 背景
多模态数据，其应用能够提升历史行为模型的准确性。具体而言，多模态数据可用于衡量目标物品与用户过往交互物品之间的语义相似度。以物品图片为例，它们可用于衡量目标物品的图片与过往交互物品图片之间的视觉相似度。直观地说，更高的语义相似度意味着目标物品与用户过往行为之间的相似性更强，表明用户的兴趣程度更高。这一见解强调了设计专门的预训练任务的重要性，以便使多模态表示能够有效地辨别不同物品对之间的语义相似度。

## 1 论文解决的问题：
目前大量工业推荐系统完全依赖于身份特征。这通常是因为人们担心多模态数据带来的性能提升可能无法弥补其部署所涉及的成本。因此，多模态表示的成功集成取决于提高其性能优势，同时最小化部署成本的能力。想实现这两个关键目标，必须应对三个实际挑战：
* 预训练任务的设计：多模态表示在提高性能方面的有效性取决于它们提供有意义的语义信息的能力，这是ID特征难以捕获的。设计预训练是必要的使多模态表示能够封装此类语义信息的任务。
* 多模态表示的整合：由于身份识别特征与多模态表示之间存在固有的差异，比如训练周期的不同，这就要求有一些方法能够有效地将多模态表示整合到基于身份识别的模型中。这些方法应当充分利用每种特征类型的优点，以提升模型的整体性能。
* 生产系统的设计：整个生产流程，包括为新物品生成多模态表示以及将其在后续任务中进行及时应用，都应以高效性为设计原则。

## 2 论文创新点：
* 为应对这些挑战，我们采用了如图 1 所示的两阶段框架。具体而言，在预训练阶段，我们提出了语义感知对比学习（SCL）方法。在这个阶段，我们利用用户的搜索查询和随后的购买行为来构建具有语义相似性的样本对，捕捉到在电子商务场景中对用户最为重要的语义相似性的维度。对于负样本，我们从一个大型记忆库中获取。SCL 方法使多模态表示能够有效地衡量项目之间的语义相似性。
* 在获得高质量的多模态表示后，我们提出了两种方法将这些表示融入现有的基于 ID 的模型中。首先，我们开发了一种名为 SimTier 的方法，用于**衡量目标项与用户之前交互过的项之间的相似度**。然后，生成的 SimTier 向量与其他嵌入一起被连接起来，并输入到后续层中。此外，为了解决多模态表示和 ID 嵌入在训练轮数上的差异问题，我们引入了多模态知识提取器（MAKE）模块。MAKE 模块将与多模态表示相关的参数优化与之分离。这些属于基于身份的模型，能够使与多模态表示相关的参数实现更有效的学习。

### 2.1 预训练数据集的构建：
在电子商务的背景下，用户的搜索查询以及随后的购买行为往往表明该查询与所购商品之间存在很强的语义相似性。例如，如果用户搜索一张枕头的图片，然后购买了一款枕头，那么这一系列操作就表明这两张图片（查询到的图片和所购买物品的图片）在语义上足够相似，能够满足用户的购买意愿。因此，如表 1 所示，在训练文本编码器时，我们将用户搜索查询的文本与他们最终购买的商品的标题作为语义相似对进行配对。同样，对于图像模式，用户从淘宝的图片搜索场景中获得的图片查询与后续购买的商品的图片进行配对。这种配对策略自然地捕捉到了与电子商务场景中用户最为相关的语义相似性的维度，反映了影响他们购买决策的因素。

对于每一对语义相似的样本，我们将当前批次中的所有其他样本视为潜在的不相似样本，这可以通过将当前批次中的样本用作负样本来实现。为了进一步提高模型的性能，我们旨在增加训练期间可用的负样本数量。具体而言，我们从 MoCo [12] 中获得灵感，并采用了使用动量更新模型的技术，从而能够从更大的记忆库中更有效地抽取更多负样本。关于构建负样本对的更复杂策略，例如识别困难负样本 [23]，将在第 6.1.2 节中详细阐述。

### 2.1 技巧：
* 将多模态表示直接整合到基于 ID 的模型中并不能达到最佳性能，这一点在第 6.3 节中有更详细的说明。出现这一问题的原因在于，与多模态表示相关的参数，例如与多模态表示相连的多层感知机的参数，在与 ID 嵌入进行联合训练的过程中并未得到充分学习[29]。相比之下，简化多模态表示使用方式的策略，例如将其转换为语义 ID（从而用 ID 来表示嵌入向量）[26， 29]，似乎能带来更好的性能。
* 我们发现，利用多模态数据的模型通过在同一个数据集上进行多个周期的训练而受益，其性能随着训练周期的增加而显著提升。相比之下，基于身份的模型则存在一周期过拟合现象，即在第二个周期开始时模型性能会急剧下降[33]。这一结果表明，与多模态表示相关的参数需要更多的周期才能正确收敛，这与基于身份的模型的行为形成了对比。因此，当将多模态表示纳入基于身份的模型并仅训练一个周期时，存在多模态相关参数可能未得到充分训练的风险

## 4 模型结构与实现代码：
### 4.1 SimTier：
观察 1 呼吁简化多模态表示的使用方式。为此，我们提出了一种简单但有效的方法——SimTier。如图 2（a）所示，SimTier 从计算目标候选项的多模态表示（记为 vc）与其它元素之间的点积相似度开始。在计算出相似度分数后，我们将分数范围[-1.0, 1.0]划分为 N 个预定义的层级。在每个层级内，我们统计落入该对应范围内的相似度分数的数量。因此，我们得到一个 N 维向量，每个维度代表对应层级中的相似度分数的数量。这样，SimTier 就有效地将一组高维多模态表示转换为一个 N 维向量，该向量封装了目标项与用户历史交互之间的相似度程度。然后，将获得的 N 维向量与其他嵌入向量连接起来，并输入到后续的多层感知机（MLP）中。我们在算法 1 中提供了 SimTier 的伪代码。

## 5 实验与分析：

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTI0Mjk5NzY2MF19
-->