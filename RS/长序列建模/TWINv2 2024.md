# TWIN V2: Scaling Ultra-Long User Behavior Sequence Modeling for Enhanced CTR Prediction at Kuaishou
[原文链接]()
## 0 摘要：
在大规模推荐系统中，为点击率预测任务建立长期用户兴趣模型的重要性正逐渐受到研究人员和从业者的重视。现有的工作，如 SIM 和 TWIN，通常采用两阶段方法来对与目标项相关的长期用户行为序列进行建模，这是出于效率方面的考虑。第一阶段使用基于搜索的机制（即通用搜索单元 GSU）从长序列中快速检索与目标项相关的子序列，而第二阶段则使用精确搜索单元（ESU）对检索结果进行计算以得出兴趣得分。鉴于用户行为序列的长度跨越整个生命周期，规模可能高达 $10^6$，目前还没有有效的解决方案能够完全建模如此庞大的用户兴趣。为了克服这一问题，我们引入了 TWIN-V2，这是对 TWIN 的改进版本，其中应用了分而治之的方法来压缩生命周期行为并揭示更准确和多样化的用户兴趣。具体而言，一种**层次聚类方法**在离线阶段会将具有相似生命周期行为特征的项目归为一个单一的聚类组。通过限制聚类的规模，我们能够将行为序列压缩到远远小于 $10^5$ 的规模，从而在 GSU 检索的在线推理中实现可管理的长度。**具有聚类意识的目标关注机制能够提取用户全面且多方面的长期兴趣，从而使最终的推荐结果更加准确和多样化**。在数十亿规模的工业数据集上进行的大量离线实验以及在线 A/B 测试证明了 TWIN-V2 的有效性。在高效的部署框架下，TWIN-V2 已成功部署到快手为数亿日活跃用户提供服务的主要流量中。

## 背景
例如，SIM、ETA 和 SDIM 可以过滤历史行为，但最长只能达到 103 个。TWIN 将最长长度扩展到了 104 到 105 级别。在部署过程中，TWIN 会利用最近的 10，000 个行为作为 GSU 的输入。不幸的是，这 10，000 个行为仅涵盖了快手应用程序中用户在过去 3-4 个月内的历史记录，未能涵盖用户行为的整个生命周期。

## 1 论文解决的问题：
我们分析了过去三年内快手应用程序中的用户行为。中高用户群体在过去三年中可以观看 104 到 106 个视频，占该应用程序使用时长的大部分（60% + 35% = 95%）。因此，对整个生命周期进行建模是必要的。

## 2 论文创新点：
为解决这一问题，我们提出了 TWIN-V2，这是对 TWIN 的改进，使其能够模拟用户行为的整个生命周期。TWIN-V2 采用分而治之的方法，将整个生命周期的历史分解为不同的集群，并利用这些集群来模拟用户的长期兴趣。具体而言，我们将模型分为两个部分：离线部分和在线部分。**在离线部分，我们使用层次聚类将生命周期行为中的相似项目聚合成集群，并从每个集群中提取特征以形成虚拟项目。在在线部分，我们利用基于聚类行为的集群感知目标注意力来提取长期兴趣。在此，注意力得分会根据相应的集群大小进行重新加权**。大量的实验表明，TWIN-V2 在各种类型的用户中都提高了性能，从而产生了更准确和多样化的推荐结果。

### 2.1 Hierarchical Clustering Over Life Cycle (生命周期层次聚类)
对于用户 u 而言，我们将其所有历史行为表示为一个项目序列 S = [s1， s2， · · · ， sT]，其中 T 是生命周期行为的数量，s j 是第 j 个交互项目。用户可能会在 S 中观看许多相似的视频。例如，一个喜欢 NBA 比赛的用户在其历史记录中可能会有数百个与篮球相关的视频。因此，一个自然的想法是将 S 中相似的项目聚合到簇中，使用一个单一的簇来代表许多相似的项目，从而减少 T 的大小。正式地说，我们的目标是使用压缩函数 hcomp 将长度为 T 的行为序列 S 减少为长度为 Tˆ 的序列 C：



## 4 模型结构与实现代码：


## 5 实验与分析：

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTYyNjM0NjU2OSwtMjE5MDk5ODY5LC0xOT
EwNTkwNzQ4LC0yMzUzMDU4NDcsMTcxODE1NDQ3MF19
-->