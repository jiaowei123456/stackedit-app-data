# Sampling Is All You Need on Modeling Long-Term User Behaviors for CTR Prediction
[原文链接](https://doi.org/10.1145/3383313.3412236)
## 0 摘要：
丰富的用户行为数据已被证明对点击率（CTR）预测应用具有极大价值，尤其是在工业推荐、搜索或广告系统中。然而，由于在线服务时间的严格要求，现实世界中的系统很难充分利用长期用户行为。大多数先前的工作采用**基于检索的策略，即首先检索少量用户行为以供后续关注**。然而，基于检索的方法并非最优，会导致信息丢失，并且难以平衡检索算法的有效性和效率。在本文中，我们提出了 SDIM（Sampling-based Deep Interest Modeling，基于采样的深度兴趣建模），这是一种简单而有效的基于采样的端到端方法，用于建模长期用户行为。我们**从多个哈希函数中采样，生成候选项目和用户行为序列中每个项目的哈希签名**，并**通过直接收集与候选项目具有相同哈希签名的行为项目来获取用户兴趣**。我们从理论和实验两方面证明，所提出的方法在对长期用户行为建模方面与标准的基于注意力的模型表现相当，但速度要快很多。我们还介绍了在系统中部署 SDIM 的情况。具体来说，我们通过设计一个名为 BSE（行为序列编码）的独立模块，将最耗时的行为序列哈希与 CTR 模型分离。BSE 对 CTR 服务器来说是无延迟的，这使我们能够对极长的用户行为进行建模。我们进行了离线和在线实验来证明 SDIM 的有效性。SDIM 现已部署在美团 APP 的搜索系统中。

## 背景
* 在线服务时间的严格要求限制了可用于建模的用户行为序列的长度。因此，大多数工业系统会截断用户行为序列，并仅使用最近的 50 个行为来进行用户兴趣建模[17， 18]，这导致了信息的丢失。

## 1 论文解决的问题：
* SIM、UBR4CTR 和 ETA 都是基于检索的方法。基于检索的方法存在以下缺陷：**从整个序列中检索出前 k 个项目并非最优选择，这会导致对用户长期兴趣的估计出现偏差**。如果用户有丰富的行为记录，检索出的前 k 个项目可能都与候选项目相似，从而导致对用户兴趣表示的估计不准确。
* 此外，很难在检索算法的有效性和效率之间取得平衡。以 SIM（严格型）为例，它使用的是一个简单的检索算法，因此其性能不如其他方法。相比之下，UBR4CTR 通过复杂的检索模块实现了显著的改进，但其推理速度却慢了 4 倍[12]，这使得 UBR4CTR 无法在线部署，尤其是在对长期用户行为建模方面。
* 
## 2 论文创新点：
在本文中，我们提出了一种基于简单哈希抽样的方法来模拟长期用户行为。
* 首先，我们从多个哈希函数中进行抽样，以生成目标项以及用户行为序列中每个项的哈希签名。我们并非使用某种度量标准来检索前 k 个相似项，而是直接从整个序列中收集与目标项具有相同哈希签名的行为项，从而形成用户兴趣。
* 我们方法背后的内在思想是用 LSH 冲突概率来近似用户兴趣的 softmax 分布。我们从理论上证明，这种基于抽样的简单方法会产生与基于 softmax 的目标注意力非常相似的注意力模式，并且能够实现一致的模型性能，同时具有更高的时间效率。
* 因此，我们的方法就像直接在原始长序列上计算注意力一样，没有信息损失。我们将所提出的这种方法命名为 SDIM（基于抽样的深度兴趣建模）。

### 2.1 主要原理
先看左边的方框, 最左边是长度为4的行为序列, 每个行为都会使用4个哈希函数计算()得到每个行为的哈希签名, 比如第1个行为的哈希签名为(1,-1,1,1), 对它进行两两分组, 得到(1,-1)和(1,1)两个签名, 分别用黄色和绿色表示, 然后分别对黄色部分和绿色部分按签名进行聚合, 比如对于黄色(1,-1)签名, 有和两种行为, 然后对和的两个向量做l2归一化处理, 得到这个签名的表征。

右边的方框有3个候选的Target Item, 每个Item都做同样的哈希函数计算得到对应的签名, 比如对于候选Item , 其经过哈希后得到的两个签名分别是 (1,-1) 和 (1,1), 然后分别从黄色和绿色表格中查找对应的签名表征, 将两个表征求平均就得到了该用户对应的兴趣表征。
![输入图片说明](/imgs/2025-07-18/dIzSaPsgKxK6mKb9.png)

### 2.1 技巧：


## 4 模型结构与实现代码：
### 4.1 


## 5 实验与分析：

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTIwMTg5NzQxNjAsMTQyMzM3Mjg5NCwxMT
k1OTg3NDE2XX0=
-->